title: d3基础
toc: false
date: 2016-08-24 10:58:56
tags:
  - 数据可视化
categories:
  - D3.js
---

数据可视化的目的，是要对数据进行可视化处理，以使得能够明确地、有效地传递信息。

<!-- more -->
[https://github.com/d3/d3/wiki]()
[https://github.com/d3/d3/wiki/API--%E4%B8%AD%E6%96%87%E6%89%8B%E5%86%8C]()
# 数据可视化的构成要素
数据可视化的手法很多，其中有一些共通的视觉要素，整理如下。

- 坐标。数值的位置被对应到直角坐标系或极坐标系上。
- 大小。数据的大小被对应到图形的大小。
- 色彩。数值的分类和界限等对应到颜色的不同。
- 标签。数值的特征用标签来标记。
- 关联。数值之间的联系，用关联线条等连接起来。


# 选择集与数据
d3.select 和 d3.selectAll 返回的对象称为 选择集（selection）， 添加、删除、设定网页中的元素都得使用选择集

## 选择集

### selection.classed(names[, value])
selection.classed("foo bar", true)
selection.classed({"foo": true,  "bar": true})
添加或去除某类

If the value is a function, then the function is evaluated for each selected element
```
selection.classed("foo", function() { return Math.random() > 0.5; });
```

### selection.property(name[, value])
Some HTML elements have special properties that are not addressable using attributes or styles, such as a form field’s text value and a checkbox’s checked boolean

## 数据

### selection.datum([value])
获取或设置每个选定的元素绑定的数据。不像selection.data方法，这种方法不计算一个连接（并因此不计算enter和exit的选择）。此方法在selection.property之上实现：
```javascript
d3.selection.prototype.datum = function(value) {
  return arguments.length < 1
      ? this.property("__data__")
      : this.property("__data__", value);
};
```
**在被绑定数据的选择集中添加元素后， 新元素会继承该数据**

### selection.data([values[, key]])

- data join 数据连接

[Thinking with Joins](https://bost.ocks.org/mike/join/)


update: 数组长度 = 元素数量
enter:  数组长度 > 元素数量,  则部分不存在的元素“即将进入可视化”
exit:   数组长度 < 元素数量， 则多余的元素“即将推出可视化”

The data is specified for each group in the selection. If the selection has multiple groups (such as d3.selectAll followed by selection.selectAll), then data should typically be specified as a function. ***This function will be evaluated for each group in order, being passed the group’s parent datum (d, which may be undefined), the group index (i), and the selection’s parent nodes (nodes), with this as the group’s parent element.*** For example, to create an HTML table from a matrix of numbers:

```javascript
var matrix = [
  [11975,  5871, 8916, 2868],
  [ 1951, 10048, 2060, 6171],
  [ 8010, 16145, 8090, 8045],
  [ 1013,   990,  940, 6907]
];

var tr = d3.select("body")
  .append("table")
  .selectAll("tr")
  .data(matrix)
  .enter().append("tr");

// 4次data后最后进行16次text
var td = tr.selectAll("td")
  .data(function(d) { return d; })
  .enter().append("td")
    .text(function(d) { return d; });
```


Whenever this code is run, it recomputes the data join and maintains the desired correspondence between elements and data
```javascript
var circle = svg.selectAll("circle")
  .data(data);

circle.exit().remove();

circle.enter().append("circle")
    .attr("r", 2.5)
  .merge(circle)
    .attr("cx", function(d) { return d.x; })
    .attr("cy", function(d) { return d.y; });
```

- 绑定顺序

todo

# 比例尺和坐标轴

## 比例尺
