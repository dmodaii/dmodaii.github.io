title: iframe
toc: false
date: 2016-08-05 11:49:00
tags:
 - cors
 - iframe
categories:
 - web前端
---


前端js中iframe 的跨域以及其他处理
<!--more-->

# form和iframe完美配合处理

form表单提交数据后并不想跳转页面， 而是根据返回数据有特定处理， 则将target="exportData"指向***特定iframe***
例如下面就是form中提交要生成的excel数据给服务器处理， 在服务器中处理最后输出二进制数据流到iframe, 实现本页下载
```html
<form class="exportForm" action="report.php" method="post" target="exportData">
  提交的数据
  <li class ="exportRep">导出报表</li>
</form>

<iframe style="display:none" name="exportData"></iframe>
```

report.php

```PHP
<?php
$excel = new PHPExcel();
// excel数据处理
$write = new PHPExcel_Writer_Excel5($excel);
//清除缓存
ob_clean();
// 输出二进制下载文件
header("Pragma: public");
header("Expires: 0");
header("Cache-Control:must-revalidate, post-check=0, pre-check=0");
header("Content-Type:application/force-download");
header("Content-Type:application/vnd.ms-execl");
header("Content-Type:application/octet-stream");
header("Content-Type:application/download");;
header('Content-Disposition:attachment;filename="report.xls"');
header("Content-Transfer-Encoding:binary");
$write->save('php://output');
```

# iframe跨域

当前域：A  请求的域：B

>用form提交的页面都是相当于直接在浏览器中中直接打开， 不会产生跨域； 跨域是在A 下面
```html
<iframe src='B/action.php' name='test'>
```
这样是直接跨域： A 跨域请求 B的内容； 这个时候则需要B/action.php 允许跨域； 通过form提交的不需要服务器端允许跨域

## 请求跨域中的内容

### 原理

A提交内容给B/action.php, target指向***特定iframe***（该iframe内容即为 B/action.php输出的内容）,  B/action.php做完相应处理后跳转到 A域下面的某个同域页面A1，然后就可以在A1中只要通过window.parent就能操作父窗口的元素， 因为这个时候A1和A(window.parent)在同域下了 ; 如果B/action.php做完处理后直接输出或重定向B域下的文件， 那么window.parent存在跨域

具体代码见 https://pandao.github.io/editor.md/   中的跨域图片上传
